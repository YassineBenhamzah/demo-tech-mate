import{c as P,u as O,r as c,j as e,B as x,C as f,Q as l,F as v,M as _,a as k,I as $,b as s,D as h,f as m}from"./index-BfMqFk4q.js";import{P as G}from"./plus-RLwd5G4T.js";import{C as U}from"./circle-check-big-DR76e3xY.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],J=P("file-check",H);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],p=P("printer",Z),X=()=>{const{quotes:y,deliveries:u,invoices:j,updateQuoteStatus:T,createInvoiceFromQuote:R,clients:g,products:C,addQuote:M}=O(),[r,i]=c.useState("quotes"),[z,d]=c.useState(!1),[D,S]=c.useState(""),[A,I]=c.useState(""),[N,E]=c.useState(1),L=t=>{switch(t){case l.ACCEPTED:return e.jsx(s,{color:"green",children:"Accepté"});case l.DRAFT:return e.jsx(s,{color:"gray",children:"Brouillon"});case l.SENT:return e.jsx(s,{color:"blue",children:"Envoyé"});case l.REJECTED:return e.jsx(s,{color:"red",children:"Refusé"});case l.INVOICED:return e.jsx(s,{color:"purple",children:"Facturé"});default:return e.jsx(s,{color:"gray",children:t})}},B=t=>{switch(t){case h.PENDING:return e.jsx(s,{color:"yellow",children:"En attente"});case h.IN_TRANSIT:return e.jsx(s,{color:"blue",children:"En cours"});case h.DELIVERED:return e.jsx(s,{color:"green",children:"Livré"});case h.CANCELLED:return e.jsx(s,{color:"red",children:"Annulé"});default:return e.jsx(s,{color:"gray",children:t})}},F=t=>{switch(t){case m.PAID:return e.jsx(s,{color:"green",children:"Payé"});case m.PARTIAL:return e.jsx(s,{color:"yellow",children:"Partiel"});case m.UNPAID:return e.jsx(s,{color:"red",children:"Impayé"});case m.OVERDUE:return e.jsx(s,{color:"red",children:"En retard"});default:return e.jsx(s,{color:"gray",children:t})}},Q=t=>{t.preventDefault();const o=g.find(a=>a.id===D),n=C.find(a=>a.id===A);if(o&&n){const a=n.sellPrice*N,w=a*.2;M({clientId:o.id,clientName:o.company||o.name,date:new Date().toISOString().split("T")[0],items:[{productId:n.id,productName:n.name,quantity:N,unitPrice:n.sellPrice,total:a}],subTotal:a,taxAmount:w,total:a+w}),d(!1),S(""),I(""),E(1)}},V=t=>{confirm("Voulez-vous générer la facture et le bon de livraison pour ce devis ?")&&(R(t),i("invoices"))},b=t=>{alert(`Impression du document ${t} en cours...`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Ventes & Devis"}),e.jsx("p",{className:"text-slate-500",children:"Gérez le cycle de vente de A à Z"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"outline",icon:p,children:"Rapports"}),e.jsx(x,{icon:G,onClick:()=>d(!0),children:"Nouveau Devis"})]})]}),e.jsx("div",{className:"border-b border-slate-200",children:e.jsxs("nav",{className:"-mb-px flex gap-6",children:[e.jsxs("button",{onClick:()=>i("quotes"),className:`pb-4 px-2 text-sm font-medium border-b-2 transition-colors ${r==="quotes"?"border-brand-600 text-brand-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:["Devis (",y.length,")"]}),e.jsxs("button",{onClick:()=>i("orders"),className:`pb-4 px-2 text-sm font-medium border-b-2 transition-colors ${r==="orders"?"border-brand-600 text-brand-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:["Bons de Livraison (",u.length,")"]}),e.jsxs("button",{onClick:()=>i("invoices"),className:`pb-4 px-2 text-sm font-medium border-b-2 transition-colors ${r==="invoices"?"border-brand-600 text-brand-600":"border-transparent text-slate-500 hover:text-slate-700"}`,children:["Factures (",j.length,")"]})]})}),r==="quotes"&&e.jsx(f,{className:"overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-700 font-semibold border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-4 px-6",children:"Référence"}),e.jsx("th",{className:"py-4 px-6",children:"Client"}),e.jsx("th",{className:"py-4 px-6",children:"Date"}),e.jsx("th",{className:"py-4 px-6 text-right",children:"Montant TTC"}),e.jsx("th",{className:"py-4 px-6 text-center",children:"Statut"}),e.jsx("th",{className:"py-4 px-6 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:y.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"py-4 px-6 font-medium text-brand-600 cursor-pointer",children:t.reference}),e.jsx("td",{className:"py-4 px-6",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"font-medium text-slate-900",children:t.clientName})})}),e.jsx("td",{className:"py-4 px-6 text-slate-500",children:t.date}),e.jsxs("td",{className:"py-4 px-6 text-right font-bold text-slate-900",children:[t.total.toLocaleString()," MAD"]}),e.jsx("td",{className:"py-4 px-6 text-center",children:L(t.status)}),e.jsx("td",{className:"py-4 px-6 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[t.status===l.DRAFT&&e.jsx("button",{onClick:()=>T(t.id,l.ACCEPTED),className:"text-slate-400 hover:text-emerald-600 transition-colors",title:"Valider Devis",children:e.jsx(U,{size:18})}),t.status===l.ACCEPTED&&e.jsx("button",{onClick:()=>V(t.id),className:"text-slate-400 hover:text-purple-600 transition-colors",title:"Facturer",children:e.jsx(J,{size:18})}),e.jsx("button",{onClick:()=>b(t.reference),className:"text-slate-400 hover:text-slate-600 transition-colors",title:"Imprimer",children:e.jsx(p,{size:18})}),e.jsx("button",{className:"text-slate-400 hover:text-brand-600 transition-colors",title:"Détails",children:e.jsx(v,{size:18})})]})})]},t.id))})]})})}),r==="orders"&&e.jsx(f,{className:"overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-700 font-semibold border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-4 px-6",children:"Référence BL"}),e.jsx("th",{className:"py-4 px-6",children:"Référence Devis"}),e.jsx("th",{className:"py-4 px-6",children:"Client"}),e.jsx("th",{className:"py-4 px-6",children:"Date"}),e.jsx("th",{className:"py-4 px-6 text-center",children:"Articles"}),e.jsx("th",{className:"py-4 px-6 text-center",children:"Statut"}),e.jsx("th",{className:"py-4 px-6 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:u.length>0?u.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"py-4 px-6 font-medium text-brand-600",children:t.reference}),e.jsx("td",{className:"py-4 px-6 text-slate-500",children:t.quoteReference||"-"}),e.jsx("td",{className:"py-4 px-6 font-medium text-slate-900",children:t.clientName}),e.jsx("td",{className:"py-4 px-6 text-slate-500",children:t.date}),e.jsx("td",{className:"py-4 px-6 text-center font-bold",children:t.itemsCount}),e.jsx("td",{className:"py-4 px-6 text-center",children:B(t.status)}),e.jsx("td",{className:"py-4 px-6 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>b(t.reference),className:"text-slate-400 hover:text-slate-600 transition-colors",title:"Imprimer BL",children:e.jsx(p,{size:18})}),e.jsx("button",{className:"text-slate-400 hover:text-brand-600 transition-colors",title:"Détails",children:e.jsx(v,{size:18})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-8 text-center text-slate-500",children:"Aucun bon de livraison."})})})]})})}),r==="invoices"&&e.jsx(f,{className:"overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-700 font-semibold border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-4 px-6",children:"Référence"}),e.jsx("th",{className:"py-4 px-6",children:"Client"}),e.jsx("th",{className:"py-4 px-6",children:"Date d'échéance"}),e.jsx("th",{className:"py-4 px-6 text-right",children:"Montant Total"}),e.jsx("th",{className:"py-4 px-6 text-right",children:"Payé"}),e.jsx("th",{className:"py-4 px-6 text-center",children:"Statut"}),e.jsx("th",{className:"py-4 px-6 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:j.length>0?j.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"py-4 px-6 font-medium text-brand-600",children:t.reference}),e.jsx("td",{className:"py-4 px-6 font-medium text-slate-900",children:t.clientName}),e.jsx("td",{className:"py-4 px-6 text-slate-500",children:t.dueDate}),e.jsxs("td",{className:"py-4 px-6 text-right font-bold text-slate-900",children:[t.total.toLocaleString()," MAD"]}),e.jsxs("td",{className:"py-4 px-6 text-right text-emerald-600",children:[t.paidAmount.toLocaleString()," MAD"]}),e.jsx("td",{className:"py-4 px-6 text-center",children:F(t.status)}),e.jsx("td",{className:"py-4 px-6 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>b(t.reference),className:"text-slate-400 hover:text-slate-600 transition-colors",title:"Imprimer Facture",children:e.jsx(p,{size:18})}),e.jsx("button",{className:"text-slate-400 hover:text-brand-600 transition-colors",title:"Détails",children:e.jsx(v,{size:18})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-8 text-center text-slate-500",children:"Aucune facture générée."})})})]})})}),e.jsx(_,{isOpen:z,onClose:()=>d(!1),title:"Nouveau Devis Rapide",children:e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs(k,{label:"Client",value:D,onChange:t=>S(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Sélectionner un client"}),g.map(t=>e.jsx("option",{value:t.id,children:t.company||t.name},t.id))]}),e.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsx("h4",{className:"font-medium text-sm mb-3",children:"Ajouter un produit (Simplifié)"}),e.jsxs(k,{label:"Produit",value:A,onChange:t=>I(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Sélectionner un produit"}),C.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.sellPrice," MAD) - Stock: ",t.stock]},t.id))]}),e.jsx("div",{className:"mt-3",children:e.jsx($,{label:"Quantité",type:"number",min:"1",value:N,onChange:t=>E(parseInt(t.target.value)),required:!0})})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-2",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Annuler"}),e.jsx(x,{type:"submit",children:"Créer le Devis"})]})]})})]})};export{X as Sales};
